<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<div class="dashboard-container">
  <header class="toolbar">
    <div class="toolbar-left">
      <span class="logo-text">(Mine) LiveU Vision AI</span>
      <div class="project-dropdown">
        <button mat-button class="project-button">
          Project <i class="fas fa-chevron-down"></i>
        </button>
      </div>
    </div>
    <div class="toolbar-right">
      <i class="fas fa-cog settings-icon"></i>
    </div>
  </header>
  <br>
  <div class="main-content">
    <div class="video-grid">
      <div class="video-card" *ngFor="let stream of streams; let i = index">
        <mat-card>
          <mat-card-title>
            <div class="card-header">
              <div class="card-title-group">
                <i class="icon" [ngClass]="getStreamIcon(stream)"></i>
                <span class="title-text">{{ getStreamTitle(stream) }}</span>
              </div>
              <div class="card-actions-top">
                <i class="fas fa-bell card-icon"></i>
                <i class="fas fa-info-circle card-icon"></i>
                <i class="fas"
                  [ngClass]="{'fa-expand-alt': maximizedCardIndex !== i, 'fa-compress-alt': maximizedCardIndex === i}"
                  class="card-icon maximize-icon" (click)="toggleMaximize(i)" style="margin-top: -7px;"></i>
              </div>
            </div>
          </mat-card-title>
          <div class="video-wrapper">
            <input #fileInputGrid type="file" accept="video/mp4" style="display: none;"
              (change)="visionService.loadVideoFile($event, stream, videoFilePlayers.toArray()[i]?.nativeElement!)" />

            <ng-container *ngIf="visionService.inputSource[stream] === 'file'">
              <video #videoFilePlayer [id]="'video-file-player-' + i" autoplay muted controls></video>
            </ng-container>
            <ng-container
              *ngIf="visionService.inputSource[stream] === 'laptop-camera' || visionService.inputSource[stream] === 'smartphone-camera'">
              <video #cameraVideoPlayer [id]="'camera-video-player-' + i" autoplay muted playsinline></video>
            </ng-container>
            <div class="overlay" *ngFor="let face of getOverlay(stream)">
              <div class="face-rect"
                [ngStyle]="{ left: face.x + 'px', top: face.y + 'px', width: face.w + 'px', height: face.h + 'px' }">
                <span class="label">{{ face.label }}</span>
              </div>
            </div>
            <div class="captions">
              {{ getCaptions(stream) }}
            </div>
          </div>
          <mat-card-actions>
            <button mat-button (click)="startOperation(stream, 'stt-openai')">Transcribe (OpenAI)</button>
            <button mat-button (click)="startOperation(stream, 'stt')">Transcribe (Azure)</button>
            <button mat-button (click)="startOperation(stream, 'translate')">Translate</button>
            <button mat-button (click)="startOperation(stream, 'faces')">Faces</button>
            <button mat-button (click)="startOperation(stream, 'ocr')">OCR</button>

            <button mat-icon-button [matMenuTriggerFor]="inputSourceMenuGrid"
              [matMenuTriggerData]="{ currentStream: stream, currentFileInput: fileInputGrid }">
              <mat-icon>more_vert</mat-icon> </button>
            <mat-menu #inputSourceMenuGrid="matMenu">
              <ng-template matMenuContent let-currentStream="currentStream" let-currentFileInput="currentFileInput">
                <button mat-menu-item
                  (click)="onInputSourceChange(currentStream, (currentStream === 'Stream 1' ? 'laptop-camera' : 'smartphone-camera'))"
                  [disabled]="(currentStream === 'Stream 1' && !laptopCameraDeviceId) || (currentStream === 'Stream 2' && !smartphoneCameraDeviceId)">
                  Camera Feed
                </button>
                <button mat-menu-item (click)="triggerFileInput(currentFileInput, currentStream)">
                  Video File Feed
                </button>
              </ng-template>
            </mat-menu>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <aside class="sidebar" [ngClass]="{ 'hidden': maximizedCardIndex !== null }">
      <div class="sidebar-header">
        <i class="fab fa-windows azure-icon"></i> <span class="sidebar-title">Azure</span>
        <i class="fas fa-chevron-right"></i>
      </div>
      <ul class="sidebar-menu">
        <li>Transcription</li>
        <li>Translation</li>
        <li>Face Detection</li>
        <li>OCR</li>
        <li>License Plate Detection</li>
      </ul>
    </aside>
  </div>
</div>


<!-- <div class="app-container">
  <header class="toolbar">
    <div class="toolbar-left">
      <span class="logo-text">(Gemini) LiveU Vision AI</span>
      <div class="project-dropdown">
        <button mat-button class="project-button">
          Project <i class="fas fa-chevron-down"></i>
        </button>
      </div>
    </div>
    <div class="toolbar-right">
      <i class="fas fa-cog settings-icon"></i>
    </div>
  </header>
  <div class="main-content">
    <mat-grid-list cols="2" rowHeight="50vh" gutterSize="15px" [ngClass]="{ 'hidden': maximizedCardIndex !== null }">
      <mat-grid-tile *ngFor="let stream of streams; let i = index">
        <div class="video-card" [ngClass]="{ 'maximized': maximizedCardIndex === i }">
          <mat-card>
            <div class="card-header">
              <div class="card-title-group">
                <i class="icon" [ngClass]="getStreamIcon(stream)"></i>
                <span class="title-text">{{ getStreamTitle(stream) }}</span>
              </div>
              <div class="card-actions-top">
                <i class="fas fa-bell card-icon"></i>
                <i class="fas fa-info-circle card-icon"></i>
                <i class="fas"
                  [ngClass]="{'fa-expand-alt': maximizedCardIndex !== i, 'fa-compress-alt': maximizedCardIndex === i}"
                  class="card-icon maximize-icon" (click)="toggleMaximize(i)"></i>
              </div>
            </div>

            <div class="video-wrapper">
              <input #fileInputGrid type="file" accept="video/mp4" style="display: none;"
                (change)="visionService.loadVideoFile($event, stream, videoFilePlayers.toArray()[i]?.nativeElement!)"
                class="file-input" />

              <ng-container *ngIf="visionService.inputSource[stream] === 'file'">
                <video #videoFilePlayer [id]="'video-file-player-' + i" autoplay muted controls></video>
              </ng-container>

              <ng-container
                *ngIf="visionService.inputSource[stream] === 'laptop-camera' || visionService.inputSource[stream] === 'smartphone-camera'">
                <video #cameraVideoPlayer [id]="'camera-video-player-' + i" autoplay muted playsinline></video>
              </ng-container>

              <div class="overlay" *ngFor="let face of getOverlay(stream)">
                <div class="face-rect"
                  [ngStyle]="{ left: face.x + 'px', top: face.y + 'px', width: face.w + 'px', height: face.h + 'px' }">
                  <span class="label">{{ face.label }}</span>
                </div>
              </div>

              <div class="video-controls-bottom">
                <i class="fas fa-circle live-indicator"></i>
                <i class="fas fa-play-circle control-icon"></i>
                <i class="fas fa-volume-up control-icon"></i>
                <i class="fas fa-cog control-icon"></i>
                <i class="fas fa-share-alt control-icon"></i>
                <i class="fas fa-expand control-icon"></i>
              </div>
            </div>

            <div class="captions-area">
              <span class="caption-line-1">{{ getCaptions(stream) }}</span>
              <span class="caption-line-2">{{ getCaptionLine2(stream) }}</span>
            </div>

            <mat-card-actions class="bottom-actions">
              <button mat-button (click)="startOperation(stream, 'stt-openai')">Transcribe OpenAI</button>
              <button mat-button (click)="startOperation(stream, 'stt')">Transcribe Azure</button>
              <button mat-button (click)="startOperation(stream, 'translate')">Translate</button>
              <button mat-button (click)="startOperation(stream, 'faces')">Faces</button>
              <button mat-button (click)="startOperation(stream, 'ocr')">OCR</button>

              <button mat-icon-button [matMenuTriggerFor]="inputSourceMenuGrid"
                [matMenuTriggerData]="{ currentStream: stream, currentFileInput: fileInputGrid }">
                <mat-icon>more_vert</mat-icon> </button>
              <mat-menu #inputSourceMenuGrid="matMenu">
                <ng-template matMenuContent let-currentStream="currentStream" let-currentFileInput="currentFileInput">
                  <button mat-menu-item
                    (click)="onInputSourceChange(currentStream, (currentStream === 'Stream 1' ? 'laptop-camera' : 'smartphone-camera'))"
                    [disabled]="(currentStream === 'Stream 1' && !laptopCameraDeviceId) || (currentStream === 'Stream 2' && !smartphoneCameraDeviceId)">
                    Camera Feed
                  </button>
                  <button mat-menu-item (click)="triggerFileInput(currentFileInput, currentStream)">
                    Video File Feed
                  </button>
                </ng-template>
              </mat-menu>
            </mat-card-actions>
          </mat-card>
        </div>
      </mat-grid-tile>
    </mat-grid-list>

    <div class="maximized-card-overlay" *ngIf="maximizedCardIndex !== null">
      <ng-container *ngIf="streams[maximizedCardIndex] as currentMaximizedStream">
        <div class="video-card maximized-single">
          <mat-card>
            <div class="card-header">
              <div class="card-title-group">
                <i class="icon" [ngClass]="getStreamIcon(currentMaximizedStream)"></i>
                <span class="title-text">{{ getStreamTitle(currentMaximizedStream) }}</span>
              </div>
              <div class="card-actions-top">
                <i class="fas fa-bell card-icon"></i>
                <i class="fas fa-info-circle card-icon"></i>
                <i class="fas fa-compress-alt card-icon maximize-icon" (click)="toggleMaximize(maximizedCardIndex)"></i>
              </div>
            </div>

            <div class="video-wrapper">
              <input #fileInputMaximized type="file" accept="video/mp4" style="display: none;"
                (change)="visionService.loadVideoFile($event, currentMaximizedStream, videoFilePlayers.toArray()[maximizedCardIndex]?.nativeElement!)" />

              <ng-container *ngIf="visionService.inputSource[currentMaximizedStream] === 'file'">
                <video [src]="videoFilePlayers.toArray()[maximizedCardIndex]?.nativeElement?.src" autoplay muted
                  controls></video>
              </ng-container>

              <ng-container
                *ngIf="visionService.inputSource[currentMaximizedStream] === 'laptop-camera' || visionService.inputSource[currentMaximizedStream] === 'smartphone-camera'">
                <video [srcObject]="cameraVideoPlayers.toArray()[maximizedCardIndex]?.nativeElement?.srcObject" autoplay
                  muted playsinline></video>
              </ng-container>

              <div class="overlay" *ngFor="let face of getOverlay(currentMaximizedStream)">
                <div class="face-rect"
                  [ngStyle]="{ left: face.x + 'px', top: face.y + 'px', width: face.w + 'px', height: face.h + 'px' }">
                  <span class="label">{{ face.label }}</span>
                </div>
              </div>
              <div class="video-controls-bottom">
                <i class="fas fa-circle live-indicator"></i>
                <i class="fas fa-play-circle control-icon"></i>
                <i class="fas fa-volume-up control-icon"></i>
                <i class="fas fa-cog control-icon"></i>
                <i class="fas fa-share-alt control-icon"></i>
                <i class="fas fa-expand control-icon"></i>
              </div>
            </div>

            <div class="captions-area">
              <span class="caption-line-1">{{ getCaptions(currentMaximizedStream) }}</span>
              <span class="caption-line-2">{{ getCaptionLine2(currentMaximizedStream) }}</span>
            </div>

            <mat-card-actions class="bottom-actions">
              <button mat-button (click)="startOperation(currentMaximizedStream, 'stt-openai')">Transcribe
                OpenAI</button>
              <button mat-button (click)="startOperation(currentMaximizedStream, 'stt')">Transcribe Azure</button>
              <button mat-button (click)="startOperation(currentMaximizedStream, 'translate')">Translate</button>
              <button mat-button (click)="startOperation(currentMaximizedStream, 'faces')">Faces</button>
              <button mat-button (click)="startOperation(currentMaximizedStream, 'ocr')">OCR</button>

              <button mat-icon-button [matMenuTriggerFor]="inputSourceMenuMaximized"
                [matMenuTriggerData]="{ currentStream: currentMaximizedStream, currentFileInput: fileInputMaximized }">
                <mat-icon>more_vert</mat-icon> </button>
              <mat-menu #inputSourceMenuMaximized="matMenu">
                <ng-template matMenuContent let-currentStream="currentStream" let-currentFileInput="currentFileInput">
                  <button mat-menu-item
                    (click)="onInputSourceChange(currentStream, (currentStream === 'Stream 1' ? 'laptop-camera' : 'smartphone-camera'))"
                    [disabled]="(currentStream === 'Stream 1' && !laptopCameraDeviceId) || (currentStream === 'Stream 2' && !smartphoneCameraDeviceId)">
                    Camera Feed
                  </button>
                  <button mat-menu-item (click)="triggerFileInput(currentFileInput, currentStream)">
                    Video File Feed
                  </button>
                </ng-template>
              </mat-menu>
            </mat-card-actions>
          </mat-card>
        </div>
      </ng-container>
    </div>


    <aside class="sidebar" [ngClass]="{ 'hidden': maximizedCardIndex !== null }">
      <div class="sidebar-header">
        <i class="fab fa-windows azure-icon"></i> <span class="sidebar-title">Azure</span>
        <i class="fas fa-chevron-right"></i>
      </div>
      <ul class="sidebar-menu">
        <li>Transcription</li>
        <li>Translation</li>
        <li>Face Detection</li>
        <li>OCR</li>
        <li>License Plate Detection</li>
      </ul>
    </aside>
  </div>
</div> -->
